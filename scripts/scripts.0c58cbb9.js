"use strict";angular.module("tscorerApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","mgcrea.ngStrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/Setup",{templateUrl:"views/setup.html",controller:"SetupCtrl"}).when("/Game",{templateUrl:"views/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location",function(a,b){a.$on("$locationChangeStart",function(){a.path=b.path()})}]),angular.module("tscorerApp").controller("SetupCtrl",["$scope","Handicaps","AppSettings","GameSettings",function(a,b,c,d){a.setup={},a.setup.gameTypes=c.gameTypes,a.setup.games=c.games,a.setup.setsPerMatch=c.sets,a.setup.p1={},a.setup.p1.serving=!0,a.setup.p2={},a.setup.gameType="Singles",a.setup.handicap=!0,a.setup.gamesPerSet=6,a.setup.sets=1,a.setup.serving="p1",a.setup.playHcp=!0,a.setup.calculateHcp=!0,a.setup.playDuece=!1,a.calculate=function(){var c=b.calculateHandicaps(a.setup.p1.hc,a.setup.p2.hc,a.setup.gameType);a.setup.p1.hcSettings=angular.copy(c.p1),a.setup.p2.hcSettings=angular.copy(c.p2),a.setup.lookupError=c.message,a.setup.lookupError||(a.setup.showHcp=!0,d.p1=angular.copy(a.setup.p1),d.gameType=a.setup.gameType,d.gamesPerSet=a.setup.GamesPerSet,d.setsPerMatch=a.setup.setsPerMatch,d.p2=angular.copy(a.setup.p2),d.handicap=a.setup.handicap)},a.hcpChanged=function(){a.setup.showHcp=!1},a.setServer=function(){"p1"===a.setup.serving?(a.setup.p1.serving=!0,a.setup.p2.serving=!1):(a.setup.p1.serving=!1,a.setup.p2.serving=!0)}}]),angular.module("tscorerApp").service("GameSettings",function(){return{p1:{points:"l",hcSettings:{description:"Love",startingScores:["l","l","l","l"],serves:2,key:"love"}},p2:{points:"l",hcSettings:{description:"Love",startingScores:["l","l","l","l"],serves:2,key:"love"}},gameType:"",gamesPerSet:0,setsPerMatch:0,handicap:!0,playAdvantage:!0,game:0}}),angular.module("tscorerApp").service("Handicaps",[function(){var a=function(a,d,f){var g,h={};if(h.message="",Number(a)&&Number(d))if(g=Math.round(Math.abs(a-d)),g>c[f])h.message="Maximum handicap difference for "+f+" is "+c[f];else{var i,j,k,l,m;i=b(f,g),Number(a)>=Number(d)?(l="receive",m="owe"):(l="owe",m="receive"),j=e[i[l]],j.key=i[l],k=e[i[m]],k.key=i[m],h.p1=j,h.p2=k,h.message=""}else h.message="Please enter numbers in the handicap fields";return h},b=function(a,b){for(var c;!c;)c=d[a][b.toString()],b-=1;return angular.copy(c)},c={Singles:50,Doubles:61},d={Singles:{0:{receive:"love",owe:"love"},1:{receive:"love",owe:"owequater15"},2:{receive:"love",owe:"owehalf15"},3:{receive:"rechalf15",owe:"love"},4:{receive:"love",owe:"owe15"},5:{receive:"rechalf15",owe:"owehalf15a"},6:{receive:"rec15",owe:"love"},7:{receive:"rechalf15",owe:"owehalf15"},8:{receive:"rec15",owe:"owehalf15"},9:{receive:"rechalf15",owe:"owehalf30a"},10:{receive:"rec15",owe:"owe15"},11:{receive:"rechalf15",owe:"owe30"},12:{receive:"rec15",owe:"owehalf30"},13:{receive:"rec15",owe:"owe30"},14:{receive:"rechalf30",owe:"owe15"},15:{receive:"rechalf30",owe:"owehalf30a"},16:{receive:"rechalf30",owe:"owe30"},18:{receive:"rec30",owe:"owe15"},20:{receive:"rec30",owe:"owehalf30"},22:{receive:"rec30",owe:"owe30"},24:{receive:"rec30",owe:"owe40"},26:{receive:"rec30",owe:"owe15st"},28:{receive:"rec30",owe:"owehalf30st"},30:{receive:"rec30",owe:"owe30st"},32:{receive:"rec30",owe:"owe40st"},34:{receive:"rec30",owe:"owe15st34"},36:{receive:"rec30",owe:"owehalf30st34"},38:{receive:"rec30",owe:"owe30st34"},40:{receive:"rec30",owe:"owe40st34"},42:{receive:"rec30",owe:"owe30st3"},44:{receive:"rec30",owe:"owe40st3"},46:{receive:"rec30",owe:"owehalf30st23"},48:{receive:"rec30",owe:"owe30st23"},50:{receive:"rec30",owe:"owe40st23"}},Doubles:{0:{receive:"love",owe:"love"},1:{receive:"love",owe:"owequater15"},2:{receive:"love",owe:"owehalf15"},4:{receive:"rechalf15",owe:"love"},5:{receive:"love",owe:"owe15"},6:{receive:"rechalf15",owe:"owehalf15a"},7:{receive:"rec15",owe:"love"},8:{receive:"rechalf15",owe:"owehalf15"},9:{receive:"rec15",owe:"owehalf15"},10:{receive:"rechalf15",owe:"owehalf30a"},11:{receive:"rec15",owe:"owe15"},12:{receive:"rechalf15",owe:"owe30"},13:{receive:"rec15",owe:"owehalf30"},14:{receive:"rec15",owe:"owe30"},15:{receive:"rechalf30",owe:"owe15"},17:{receive:"rechalf30",owe:"owehalf30a"},19:{receive:"rechalf30",owe:"owe30"},21:{receive:"rec30",owe:"owe15"},23:{receive:"rec30",owe:"owehalf30"},25:{receive:"rec30",owe:"owe30"},27:{receive:"rec30",owe:"owe40"},29:{receive:"rec30",owe:"owe15st"},31:{receive:"rec30",owe:"owehalf30st"},33:{receive:"rec30",owe:"owe30st"},35:{receive:"rec30",owe:"owe40st"},37:{receive:"rec30",owe:"owe15st34"},40:{receive:"rec30",owe:"owehalf30st34"},43:{receive:"rec30",owe:"owe30st34"},46:{receive:"rec30",owe:"owe40st34"},49:{receive:"rec30",owe:"owe30st3"},52:{receive:"rec30",owe:"owe40st3"},55:{receive:"rec30",owe:"owehalf30st23"},58:{receive:"rec30",owe:"owe30st23"},61:{receive:"rec30",owe:"owe40st23"}}},e={love:{description:"Love",startingScores:["l","l","l","l"],serves:2},rechalf15:{description:"Receive half 15",startingScores:["l","r1","l","r1"],serves:2},rec15:{description:"Receive 15",startingScores:["r1","r1","r1","r1"],serves:2},rechalf30:{description:"Receive half 30",startingScores:["r1","r2","r1","r2"],serves:2},rec30:{description:"Receive 30",startingScores:["r2","r2","r2","r2"],serves:2},owequater15:{description:"Owe quarter 15",startingScores:["l","l","l","o1"],serves:2},owehalf15:{description:"Owe half 15",startingScores:["l","o1","l","o1"],serves:2},owehalf15a:{description:"Owe half 15",startingScores:["o1","l","o1","l"],serves:2},owe15:{description:"Owe 15",startingScores:["o1","o1","o1","o1"],serves:2},owehalf30:{description:"Owe half 30",startingScores:["o1","o2","o1","o2"],serves:2},owehalf30a:{description:"Owe half 30",startingScores:["o2","o1","o2","o1"],serves:2},owe30:{description:"Owe 30",startingScores:["o2","o2","o2","o3"],serves:2},owe40:{description:"Owe 40",startingScores:["o3","o3","o3","o3"],serves:2},owe15st:{description:"Owe 15 One serve and banned tambour",startingScores:["o1","o1","o1","o1"],serves:1},owehalf30st:{description:"Owe half 30 One serve  banned tambour",startingScores:["o1","o2","o1","o2"],serves:1},owe30st:{description:"Owe 30 One serve and banned tambour",startingScores:["o2","o2","o2","o2"],serves:1},owe40st:{description:"Owe 40 One serve and banned tambour",startingScores:["o3","o3","o3","o3"],serves:1},owe15st34:{description:"Owe 15  One serve and banned tambour and chases worse than 3 & 4. Banned hazard chases when playing off chases & Service End is conceded after one chase",startingScores:["o1","o1","o1","o1"],serves:1,chases:3.5},owehalf30st34:{description:"Owe half 30  One serve and banned tambour and chases worse than 3 & 4. Banned hazard chases when playing off chases & Service End is conceded after one chase",startingScores:["o1","o2","o1","o2"],serves:1,chases:"threefour"},owe30st34:{description:"Owe 30  One serve and banned tambour and chases worse than 3 & 4. Banned hazard chases when playing off chases & Service End is conceded after one chase",startingScores:["o2","o2","o2","o2"],serves:1,chases:"threefour"},owe40st34:{description:"Owe 40  One serve and banned tambour and chases worse than 3 & 4. Banned hazard chases when playing off chases & Service End is conceded after one chase",startingScores:["o3","o3","o3","o3"],serves:1,chases:"threefour"},owe30st3:{description:"Owe 30  One serve and banned tambour and chases worse than 3.  Banned hazard chases when playing off chases & Service End is conceded after one chase",startingScores:["o2","o2","o2","o2"],serves:1,chases:"three"},owe40st3:{description:"Owe 40 One serve and banned tambour and chases worse than 3.  Banned hazard chases when playing off chases & Service End is conceded after one chase",startingScores:["o2","o2","o2","o2"],serves:1,chases:"three"},owehalf30st23:{description:"Owe half 30 One serve and banned tambour and banned chases worse than 2 & 3.  Banned hazard chases when playing off chases & Service End is conceded after one chase",startingScores:["o1","o2","o1","o2"],serves:1,chases:"twothree"},owe30st23:{descrtiption:"Owe 30 One serve and banned tambour and banned chases worse than 2 & 3.  Banned hazard chases when playing off chases & Service End is conceded after one chase",startingScores:["o2","o2","o2","o2"],serves:1,chases:"twothree"}};return{calculateHandicaps:a}}]),angular.module("tscorerApp").service("AppSettings",function(){var a=["Singles","Doubles"],b=[5,6,7,8,9],c=[1,3,5],d={l:"Love",r1:"Fifteen",r2:"Thirty",r3:"Forty",ad:"Advantage",o1:"Owe Fifteen",o2:"Owe Thirty",o3:"Owe Forty"},e={o3:"-40",o2:"-30",o1:"-15",l:"0",r1:"15",r2:"30",r3:"40",ad:"Ad"},f=["o3","o2","o1","l","r1","r2","r3"],g=function(a){return a&&f.push("ad"),f},h=[{key:"hbhalf",name:"Better than half a yard",type:"space",size:"half",hazard:!0},{key:"hhalf",name:"Half a yard",type:"line",size:"half",hazard:!0},{key:"hbtone",name:"Better than one yard",type:"space",size:"half",hazard:!0},{key:"hone",name:"One yard",type:"line",size:"full",hazard:!0},{key:"hwtone",name:"Worse than one yard",type:"space",size:"half",hazard:!0},{key:"honetwo",name:"One and two",type:"line",size:"half",hazard:!0},{key:"hbttwo",name:"Better than two yards",type:"space",size:"half",hazard:!0},{key:"htwo",name:"Two yards",type:"line",size:"full",hazard:!0},{key:"hwttwo",name:"Worse than two yards",type:"space",size:"half",hazard:!0},{key:"hhalfwttwo",name:"Half a yard worse than two",type:"line",size:"half",hazard:!0},{key:"hbtsecond",name:"Better than second gallery",type:"space",size:"full",hazard:!0},{key:"hsecond",name:"Second gallery",type:"line",size:"full",extraclasses:"gallery",hazard:!0},{key:"hwtsecond",name:"Worse than second gallery",type:"space",size:"full",hazard:!0},{key:"hywtsecond",name:"A yard worse than second gallery",type:"line",size:"half",hazard:!0},{key:"hbtdoor",name:"Better than the door",type:"space",size:"full",hazard:!0},{key:"hdoor",name:"The door",type:"line",size:"full",hazard:!0},{key:"hwtdoor",name:"Worse than the door",type:"space",size:"full",hazard:!0},{key:"hywtdoor",name:"A yard worse than the door",type:"line",size:"half",hazard:!0},{key:"hbtfirst",name:"Better than first gallery",type:"space",size:"full",hazard:!0},{key:"hfirst",name:"First gallery",type:"line",size:"full",extraclasses:"gallery",hazard:!0},{key:"hline",name:"The Line",type:"space",size:"full",hazard:!0},{key:"line",name:"The Line",type:"space",size:"full"},{key:"first",name:"First gallery",type:"line",size:"full",extraclasses:"gallery"},{key:"btfirst",name:"Better than first gallery",type:"space",size:"full"},{key:"ywtdoor",name:"A yard worse than the door",type:"line",size:"half"},{key:"wtdoor",name:"Worse than the door",type:"space",size:"full"},{key:"door",name:"The door",type:"line",size:"full",extraclasses:"gallery"},{key:"btdoor",name:"Better than the door",type:"space",size:"full"},{key:"ywtsecond",name:"A yard worse than second gallery",type:"line",size:"half"},{key:"wtsecond",name:"Worse than second gallery",type:"space",size:"full"},{key:"second",name:"Second gallery",type:"line",size:"full",extraclasses:"gallery"},{key:"btsecond",name:"Better than second gallery",type:"space",size:"full"},{key:"ybtsecond",name:"A yard better than second gallery",type:"line",size:"half"},{key:"mtywlast",name:"More than a yard worse than last gallery",type:"space",size:"full"},{key:"ywtlast",name:"A yard worse than last gallery",type:"line",size:"full"},{key:"nywtlast",name:"Nearly a yard worse than last gallery",type:"space",size:"half"},{key:"hywtlast",name:"Half a yard worse than last gallery",type:"line",size:"half"},{key:"wtlast",name:"Worse than last gallery",type:"space",size:"half"},{key:"last",name:"Last gallery",type:"line",size:"full",extraclasses:"gallery"},{key:"btlast",name:"Better than last gallery",type:"space",size:"half"},{key:"halfwtsix",name:"Half a yard worse than six",type:"line",size:"half"},{key:"wtsix",name:"Worse than six yards",type:"space",size:"half"},{key:"six",name:"Six yards",type:"line",size:"half"},{key:"btsix",name:"Better than six yards",type:"space",size:"half"},{key:"fivesixe",name:"Five and six",type:"line",size:"half"},{key:"wtfive",name:"Worse than five yards",type:"space",size:"half"},{key:"five",name:"Five yards",type:"line",size:"full"},{key:"btfive",name:"Better than five yards",type:"space",size:"half"},{key:"fourfive",name:"Four and five",type:"line",size:"half"},{key:"wtfour",name:"Worse than four yards",type:"space",size:"half"},{key:"four",name:"Four yards",type:"line",size:"full"},{key:"btfour",name:"Better than four",type:"space",size:"half"},{key:"threefour",name:"Three and four",type:"line",size:"half"},{key:"wtthree",name:"Worse than three yards",type:"space",size:"half"},{key:"three",name:"Three yards",type:"line",size:"full"},{key:"btthree",name:"Better than three yards",type:"space",size:"half"},{key:"twothree",name:"Two and Three",type:"line",size:"half"},{key:"wttwo",name:"Worse than two yards",type:"space",size:"half"},{key:"two",name:"Two yards",type:"line",size:"full"},{key:"bttwo",name:"Better than two yards",type:"space",size:"half"},{key:"onetwo",name:"One and two",type:"line",size:"half"},{key:"wtone",name:"Worse than one yard",type:"space",size:"half"},{key:"one",name:"One yard",type:"line",size:"full"},{key:"btone",name:"Better than one yard",type:"space",size:"half"},{key:"half",name:"Half a yard",type:"line",size:"half"},{key:"bhalf",name:"Better than half a yard",type:"space",size:"half"}];return{getScoreOrder:g,gameTypes:a,games:b,sets:c,scores:e,scoreNames:d,chases:h}}),angular.module("tscorerApp").controller("GameCtrl",["$scope","$timeout","GameSettings","AppSettings","$aside","$modal",function(a,b,c,d,e,f){a.gamedata={},a.gamedata.game=0,a.gamedata.chases=[],a.gamedata.p1=c.p1,a.gamedata.p2=c.p2,a.gamedata.p1.sets=0,a.gamedata.p2.sets=0,a.gamedata.p1.games=0,a.gamedata.p2.games=0,a.gamedata.chases=[],a.gamedata.logs=[],a.appsettings={},a.appsettings.chases=d.chases,a.gamedisplay={},a.gamedisplay.showScorecard=!1,a.gamedisplay.logclasses="size1",c.p1.serving?(a.gamedata.server="p1",a.gamedata.receiver="p2"):(a.gamedata.server="p2",a.gamedata.receiver="p1");var g=e({scope:a,template:"templates/chases.html",show:!1}),h=f({title:"Change Ends",scope:a,animation:"am-fade-and-slide-bottom",template:"templates/chasenotice.html",placement:"bottom",backdrop:"static",show:!1}),i=function(b,c,d){a.gamedata.logs.push({action:b,player:d,text:c})},j=function(b,c){var d=a.gamedata.logs[a.gamedata.logs.length-1];d.text+=", "+c,d.more||(d.more=[]),d.more.push(b)},k=function(){a.gamedata.p1.points=a.gamedata.p1.hcSettings.startingScores[Math.floor(a.gamedata.game/4)],a.gamedata.p2.points=a.gamedata.p2.hcSettings.startingScores[Math.floor(a.gamedata.game/4)],a.gamedata.p1.pointslabel=d.scores[a.gamedata.p1.points],a.gamedata.p2.pointslabel=d.scores[a.gamedata.p2.points]},l=function(b){var d=a.gamedata[b];j("game","Game to "+d.name),d.games=d.games+1,a.gamedata.notice="Game",d.games===c.gamesPerSet&&m(b),a.gamedata.game+=1,k(),a.gamedata.chases=[]},m=function(b){var d=a.gamedata[b];j("set","Set to "+d.name),d.sets=d.sets+1,a.gamedata.notice="Game and Set",d.sets===c.setsPerMatch&&n(b),a.gamedata.p1.games=0,a.gamedata.p2.games=0},n=function(b){var c=a.gamedata[b];a.gamedata.notice="Game, Set, Match",j("match","Match to "+c.name)},o=function(){var b=p()+"<br>";b+=s(0),2===a.gamedata.chases.length&&(b+="<br>",b+=s(1)),a.gamedata.chasenotice=b,h.show()},p=function(b){var e={},f="";return e.p1=d.scoreNames[a.gamedata.p1.points],e.p2=d.scoreNames[a.gamedata.p2.points],"r3"===a.gamedata.p1.points&&"r3"===a.gamedata.p2.points&&(f=c.playAdvantage?"40 all, game point":"Duece"),b||(b=q()),f=e.p1===e.p2?e.p1+" all":"p1"===b?e.p1+" - "+e.p2:e.p2+" - "+e.p1},q=function(){var b="p1",c=d.getScoreOrder(),e=c.indexOf(a.gamedata.p1.points),f=c.indexOf(a.gamedata.p2.points);return f>e&&(b="p2"),b},r=function(){var b=a.gamedata.server;a.gamedata.server=a.gamedata.receiver,a.gamedata.receiver=b,a.gamedata.p1.serving=a.gamedata.p2.serving,a.gamedata.p2.serving=!a.gamedata.p2.serving},s=function(b){var c="Chase ";return a.gamedata.chases[b].hazard&&(c="Hazard chase "),c+=a.gamedata.chases[b].name};a.awardPoint=function(b){var c,e,f,g,h,j=!1;a.gamedata[a.gamedata.server].faults=0,c=a.gamedata[b],e=c.points,f=d.getScoreOrder(),g=f.indexOf(e),a.gamedata.playingchase?(j=a.gamedata.chases[0].hazard,a.gamedata.chases.splice(0,1),0===a.gamedata.chases.length&&(a.gamedata.playingchase=!1),h="Chase won, ",(j&&b===a.gamedata.receiver||!j&&b===a.gamedata.server)&&(h="Chase lost, "),i("score",h+"Point to "+c.name,b)):i("score","Point to "+c.name,b),g+1<f.length?(c.points=f[g+1],c.pointslabel=d.scores[c.points],g+2===f.length&&(a.gamedata.isGamePoint=!0,a.gamedata.chases.length>0&&!a.gamedata.playingchase&&o()),a.gamedata.notice=a.gamedata.playingchase?s(0):p(b)):(a.gamedata.isGamePoint=!1,l(b)),a.gamedisplay.showScorecard=!1},a.recoredFault=function(){var b,c;c=a.gamedata.server,b=a.gamedata[c],i("fault",b.name+" served a fault",c),a.gamedata.notice="",1===b.hcSettings.serves?a.awardPoint(c):b.faults&&1===b.faults?(a.awardPoint(a.gamedata.receiver),a.gamedata.notice="Double "):b.faults=1,a.gamedisplay.showScorecard=!1,a.gamedata.notice+="Fault"},a.setChase=function(b){a.gamedata.chases.push(angular.copy(b));var c="Chase: ";b.hazard&&(c+="Hazard chase "),c+=b.name,i("chase",c),a.gamedata.notice="Chase",g.hide(),(2===a.gamedata.chases.length||a.gamedata.isGamePoint)&&o()},a.showChases=function(b){a.gamedisplay.scrollChaseBox=!b,a.gamedisplay.showHazard=b,a.gamedisplay.showScorecard=!1,g.show()},a.changeEnds=function(){h.hide(),r(),a.gamedata.playingchase=!0,a.gamedata.notice=s(0)},i("start","Match begins"),k()}]),angular.module("tscorerApp").controller("TestCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("tscorerApp").filter("matchboolean",function(){return function(a,b,c){var d=[];return angular.isDefined(c)||(c=!0),angular.forEach(a,function(a){(angular.isDefined(a[b])&&a[b]===c||!angular.isDefined(a[b])&&c===!1)&&d.push(a)}),d}}),angular.module("tscorerApp").directive("scrollHelp",["$timeout",function(a){return{restrict:"A",link:function(b,c){c.bind("scroll",function(){a(function(){c[0].scrollTop>angular.element(".scrolltarget").height()-c.height()?(b.showBottomHelp=!1,b.showTopHelp=!0):c.scrollTop()<100?(b.showBottomHelp=!0,b.showTopHelp=!1):(b.showBottomHelp=!1,b.showTopHelp=!1)},500)})}}}]),angular.module("tscorerApp").directive("lastCard",["$timeout",function(a){return{restrict:"A",scope:{chaselength:"=",sizeclass:"="},link:function(b){b.$watch("chaselength",function(c){c&&a(function(){var a=document.getElementById("chasecard"),c=137,d=161;b.sizeclass=a.clientHeight>d?"size3":a.clientHeight>c?"size2":"size1"},100)})}}}]),angular.module("tscorerApp").directive("scrollTop",["$timeout",function(a){return{scope:{trigger:"=",testvalue:"="},restrict:"A",link:function(b,c){b.$watch("trigger",function(b){b&&a(function(){c[0].scrollTop=1e4},200)})}}}]);